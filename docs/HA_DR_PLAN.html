<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>High Availability (HA) and Disaster Recovery (DR) Plan - 17 @ Peppertree Documentation</title>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --bg-primary: #1a1a1a;
  --bg-secondary: #242424;
  --bg-tertiary: #2d2d2d;
  --text-primary: #e0e0e0;
  --text-secondary: #b0b0b0;
  --text-muted: #808080;
  --border-color: #404040;
  --link-color: #6b9bd1;
  --link-hover: #8ab4f8;
  --code-bg: #1e1e1e;
  --table-header: #2a2a2a;
  --success: #6ba76b;
  --warning: #d4a574;
  --error: #d47474;
  --info: #74a0d4;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--bg-primary);
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* Navigation */
nav {
  background: var(--bg-secondary);
  padding: 15px 20px;
  margin: -20px -20px 30px -20px;
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 100;
}

nav a {
  color: var(--link-color);
  text-decoration: none;
  padding: 8px 12px;
  margin: 0 5px;
  border-radius: 4px;
  transition: background 0.2s;
  display: inline-block;
}

nav a:hover {
  background: var(--bg-tertiary);
  color: var(--link-hover);
}

nav a.active {
  background: var(--bg-tertiary);
  color: var(--link-hover);
}

/* Headers */
h1, h2, h3, h4, h5, h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
  color: var(--text-primary);
}

h1 {
  font-size: 2em;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 10px;
  margin-bottom: 20px;
}

h2 {
  font-size: 1.5em;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 8px;
}

h3 {
  font-size: 1.25em;
}

h4 {
  font-size: 1.1em;
}

/* Paragraphs and text */
p {
  margin-bottom: 16px;
  color: var(--text-secondary);
}

blockquote {
  border-left: 3px solid var(--link-color);
  padding: 10px 20px;
  margin: 20px 0;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  border-radius: 0 4px 4px 0;
}

blockquote p:last-child {
  margin-bottom: 0;
}

/* Links */
a {
  color: var(--link-color);
  text-decoration: none;
  transition: color 0.2s;
}

a:hover {
  color: var(--link-hover);
  text-decoration: underline;
}

/* Lists */
ul, ol {
  margin-bottom: 16px;
  padding-left: 2em;
  color: var(--text-secondary);
}

li {
  margin-bottom: 8px;
}

ul ul, ol ul, ul ol, ol ol {
  margin-bottom: 0;
  margin-top: 8px;
}

/* Code */
code {
  background: var(--code-bg);
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
  font-size: 0.9em;
  color: #d4d4d4;
  border: 1px solid var(--border-color);
}

pre {
  background: var(--code-bg);
  padding: 16px;
  border-radius: 6px;
  overflow-x: auto;
  margin-bottom: 16px;
  border: 1px solid var(--border-color);
}

pre code {
  background: none;
  padding: 0;
  border: none;
  font-size: 0.85em;
  line-height: 1.5;
}

/* Tables */
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 16px;
  background: var(--bg-secondary);
  border-radius: 6px;
  overflow: hidden;
}

thead {
  background: var(--table-header);
}

th, td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-secondary);
}

th {
  font-weight: 600;
  color: var(--text-primary);
}

tr:last-child td {
  border-bottom: none;
}

tr:hover {
  background: var(--bg-tertiary);
}

/* Horizontal rule */
hr {
  border: none;
  border-top: 1px solid var(--border-color);
  margin: 32px 0;
}

/* Checkboxes in lists */
input[type="checkbox"] {
  margin-right: 8px;
}

/* Status badges (emoji fallback) */
.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 0.85em;
  font-weight: 500;
  margin: 0 4px;
}

.badge-success {
  background: var(--success);
  color: var(--bg-primary);
}

.badge-warning {
  background: var(--warning);
  color: var(--bg-primary);
}

.badge-error {
  background: var(--error);
  color: var(--bg-primary);
}

.badge-info {
  background: var(--info);
  color: var(--bg-primary);
}

/* Back to top button */
#back-to-top {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  padding: 10px 15px;
  border-radius: 4px;
  cursor: pointer;
  display: none;
  transition: all 0.3s;
}

#back-to-top:hover {
  background: var(--bg-tertiary);
  transform: translateY(-2px);
}

/* Responsive */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  nav {
    margin: -10px -10px 20px -10px;
    padding: 10px;
  }
  
  nav a {
    display: block;
    margin: 5px 0;
  }
  
  table {
    font-size: 0.9em;
  }
  
  th, td {
    padding: 8px 10px;
  }
}

/* Print styles */
@media print {
  body {
    background: white;
    color: black;
    max-width: 100%;
  }
  
  nav, #back-to-top {
    display: none;
  }
  
  a {
    color: black;
    text-decoration: underline;
  }
}
</style>
</head>
<body>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="FEATURES.html">‚ú® Features</a>
    <a href="DEVELOPMENT_GUIDE.html">üíª Development</a>
    <a href="DEPLOYMENT_GUIDE.html">üöÄ Deployment</a>
    <a href="ADMIN_SETUP.html">üë®‚Äçüíº Admin</a>
  </nav>
  
  <main>
    <h1>High Availability (HA) and Disaster Recovery (DR) Plan</h1>
<p><strong>Document Version:</strong> 1.0<br><strong>Last Updated:</strong> 2025-11-21<br><strong>Application:</strong> 17 @ Peppertree Hospitality Booking System</p>
<hr>
<h2>Executive Summary</h2>
<p>This document outlines the High Availability and Disaster Recovery strategy for the 17 @ Peppertree application running on a <strong>2 vCPU / 8 GB RAM VPS</strong>. Given the budget-conscious nature of a small hospitality business, this plan balances cost-effectiveness with acceptable recovery objectives.</p>
<h3>Target Metrics</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Target</th>
<th>Justification</th>
</tr>
</thead>
<tbody><tr>
<td><strong>RTO</strong> (Recovery Time Objective)</td>
<td>4 hours</td>
<td>Acceptable for non-critical booking system</td>
</tr>
<tr>
<td><strong>RPO</strong> (Recovery Point Objective)</td>
<td>24 hours</td>
<td>Daily bookings can be manually recovered if needed</td>
</tr>
<tr>
<td><strong>Uptime SLA</strong></td>
<td>99.5%</td>
<td>~3.6 hours downtime/month acceptable</td>
</tr>
</tbody></table>
<hr>
<h2>1. High Availability Strategy</h2>
<h3>1.1 Current Architecture Limitations</h3>
<p><strong>Single VPS Deployment:</strong></p>
<ul>
<li>Single point of failure (SPOF)</li>
<li>No automatic failover</li>
<li>Limited by VPS provider uptime</li>
</ul>
<p><strong>Rationale for Single VPS:</strong></p>
<ul>
<li>Cost-effective for small business</li>
<li>Low traffic volume doesn&#39;t justify HA complexity</li>
<li>Manual intervention acceptable for this use case</li>
</ul>
<h3>1.2 Application-Level HA Features</h3>
<h4>Docker Container Restart Policies</h4>
<p>All services configured with <code>restart: unless-stopped</code>:</p>
<pre><code class="language-yaml">services:
  backend:
    restart: unless-stopped
  frontend:
    restart: unless-stopped
  db:
    restart: unless-stopped
  keycloak:
    restart: unless-stopped
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Automatic recovery from container crashes</li>
<li>Survives VPS reboots</li>
<li>No manual intervention for common failures</li>
</ul>
<h4>Health Checks</h4>
<p>All critical services have health checks configured:</p>
<pre><code class="language-yaml">backend:
  healthcheck:
    test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:5000/api/health&quot;]
    interval: 30s
    timeout: 10s
    retries: 3

db:
  healthcheck:
    test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]
    interval: 10s
    timeout: 5s
    retries: 5

nginx:
  healthcheck:
    test: [&quot;CMD&quot;, &quot;nginx&quot;, &quot;-t&quot;]
    interval: 30s
    timeout: 10s
    retries: 3
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Early detection of service degradation</li>
<li>Automatic container restarts on failure</li>
<li>Dependency management (depends_on with conditions)</li>
</ul>
<h3>1.3 Database High Availability</h3>
<h4>Current Setup</h4>
<ul>
<li>Single PostgreSQL 15 container</li>
<li>Persistent volumes for data</li>
<li>Daily automated backups</li>
</ul>
<h4>HA Enhancements (Optional - Higher Budget)</h4>
<p><strong>Option 1: Managed Database Service</strong></p>
<ul>
<li>Migrate to managed PostgreSQL (e.g., DigitalOcean, AWS RDS, Azure Database)</li>
<li>Cost: +$15-30/month</li>
<li>Benefits: Automated backups, point-in-time recovery, automatic failover</li>
</ul>
<p><strong>Option 2: PostgreSQL Replication</strong></p>
<ul>
<li>Requires second VPS or database server</li>
<li>Cost: +$40-60/month</li>
<li>Benefits: Hot standby, automatic failover with Patroni/pgpool</li>
</ul>
<p><strong>Recommendation:</strong> Stick with single database + robust backups for now.</p>
<h3>1.4 Monitoring and Alerting</h3>
<h4>Essential Monitoring</h4>
<p><strong>1. Uptime Monitoring (External)</strong></p>
<ul>
<li>Service: UptimeRobot (free tier) or Pingdom</li>
<li>Monitor: <a href="https://17peppertree.co.za">https://17peppertree.co.za</a></li>
<li>Check interval: 5 minutes</li>
<li>Alert methods: Email, SMS</li>
<li>Cost: Free to $10/month</li>
</ul>
<p><strong>2. Server Resource Monitoring</strong></p>
<pre><code class="language-bash"># Install monitoring tools
apt install htop iotop nethogs

# View real-time stats
htop                    # CPU/RAM usage
docker stats           # Container resources
df -h                  # Disk usage
</code></pre>
<p><strong>3. Application Logging</strong></p>
<pre><code class="language-yaml"># Already configured in docker-compose
volumes:
  - ./logs/nginx:/var/log/nginx
</code></pre>
<p><strong>Log Retention:</strong></p>
<ul>
<li>Nginx access logs: 14 days</li>
<li>Nginx error logs: 30 days</li>
<li>Application logs: 30 days</li>
<li>Database logs: 7 days</li>
</ul>
<h4>Alerting Thresholds</h4>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Warning</th>
<th>Critical</th>
<th>Action</th>
</tr>
</thead>
<tbody><tr>
<td>CPU Usage</td>
<td>&gt;70%</td>
<td>&gt;85%</td>
<td>Investigate load, consider upgrade</td>
</tr>
<tr>
<td>RAM Usage</td>
<td>&gt;70% (5.6GB)</td>
<td>&gt;85% (6.8GB)</td>
<td>Restart services, add swap</td>
</tr>
<tr>
<td>Disk Usage</td>
<td>&gt;75%</td>
<td>&gt;90%</td>
<td>Clean logs, expand storage</td>
</tr>
<tr>
<td>Website Down</td>
<td>2 min</td>
<td>5 min</td>
<td>Execute DR plan</td>
</tr>
<tr>
<td>Database Down</td>
<td>1 min</td>
<td>3 min</td>
<td>Execute DB recovery</td>
</tr>
</tbody></table>
<h3>1.5 Proactive Maintenance</h3>
<h4>Weekly Tasks</h4>
<ul>
<li><input disabled="" type="checkbox"> Review monitoring alerts</li>
<li><input disabled="" type="checkbox"> Check disk space usage</li>
<li><input disabled="" type="checkbox"> Review application logs for errors</li>
<li><input disabled="" type="checkbox"> Verify backup completion</li>
</ul>
<h4>Monthly Tasks</h4>
<ul>
<li><input disabled="" type="checkbox"> Update Docker images (security patches)</li>
<li><input disabled="" type="checkbox"> Review and rotate logs</li>
<li><input disabled="" type="checkbox"> Test backup restoration (quarterly minimum)</li>
<li><input disabled="" type="checkbox"> Review SSL certificate expiry dates</li>
</ul>
<h4>Quarterly Tasks</h4>
<ul>
<li><input disabled="" type="checkbox"> Full DR drill/test</li>
<li><input disabled="" type="checkbox"> Security audit and updates</li>
<li><input disabled="" type="checkbox"> Performance review and optimization</li>
<li><input disabled="" type="checkbox"> Capacity planning review</li>
</ul>
<hr>
<h2>2. Disaster Recovery Plan</h2>
<h3>2.1 Backup Strategy</h3>
<h4>Database Backups</h4>
<p><strong>Automated Daily Backups:</strong></p>
<pre><code class="language-bash">#!/bin/bash
# /scripts/backup.sh (already exists)

# PostgreSQL backup
docker exec peppertree_db_prod pg_dump -U postgres peppertree &gt; \
  /backups/peppertree_$(date +%Y%m%d_%H%M%S).sql

# Keycloak database backup
docker exec peppertree_keycloak_db_prod pg_dump -U keycloak keycloak &gt; \
  /backups/keycloak_$(date +%Y%m%d_%H%M%S).sql

# Compress backups
gzip /backups/*.sql

# Keep last 30 days
find /backups -name &quot;*.sql.gz&quot; -mtime +30 -delete
</code></pre>
<p><strong>Cron Schedule:</strong></p>
<pre><code class="language-bash"># Daily at 2 AM
0 2 * * * /home/jako/Development/17@peppertree/scripts/backup.sh &gt;&gt; /var/log/backup.log 2&gt;&amp;1
</code></pre>
<h4>Off-Site Backup Storage</h4>
<p><strong>Option 1: Cloud Storage (Recommended)</strong></p>
<pre><code class="language-bash"># Install rclone
curl https://rclone.org/install.sh | sudo bash

# Configure (one-time setup)
rclone config  # Add cloud provider (Google Drive, Dropbox, S3, etc.)

# Automated sync
rclone sync /backups remote:peppertree-backups --log-file=/var/log/rclone.log
</code></pre>
<p><strong>Backup Locations:</strong></p>
<ol>
<li><strong>Local:</strong> VPS <code>/backups</code> directory (immediate access)</li>
<li><strong>Off-site:</strong> Cloud storage (disaster recovery)</li>
<li><strong>Optional:</strong> Local workstation (manual download monthly)</li>
</ol>
<p><strong>Backup Verification:</strong></p>
<pre><code class="language-bash"># Weekly backup integrity check
gunzip -t /backups/peppertree_latest.sql.gz &amp;&amp; echo &quot;Backup OK&quot; || echo &quot;Backup CORRUPTED&quot;
</code></pre>
<h4>Configuration Backups</h4>
<p><strong>Critical Files to Backup:</strong></p>
<ul>
<li><code>.env</code> files (encrypted storage)</li>
<li><code>docker-compose.production.yml</code></li>
<li><code>config/nginx.production.conf</code></li>
<li>SSL certificates (<code>/ssl</code> directory)</li>
<li>Keycloak configuration exports</li>
</ul>
<p><strong>Backup Script Addition:</strong></p>
<pre><code class="language-bash"># Add to backup.sh
tar -czf /backups/config_$(date +%Y%m%d).tar.gz \
  /home/jako/Development/17@peppertree/.env \
  /home/jako/Development/17@peppertree/docker-compose.production.yml \
  /home/jako/Development/17@peppertree/config/nginx.production.conf \
  /home/jako/Development/17@peppertree/ssl
</code></pre>
<h3>2.2 Disaster Scenarios and Recovery Procedures</h3>
<h4>Scenario 1: Single Container Failure</h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>One service down (backend, frontend, database)</li>
<li>Other services operational</li>
<li>Health check failures in logs</li>
</ul>
<p><strong>Recovery Steps:</strong></p>
<pre><code class="language-bash"># 1. Identify failed container
docker ps -a

# 2. Check logs
docker logs peppertree_backend_prod --tail 100

# 3. Restart container
docker restart peppertree_backend_prod

# 4. Verify recovery
docker ps
curl https://17peppertree.co.za/api/health

# Recovery Time: 2-5 minutes
</code></pre>
<h4>Scenario 2: Database Corruption</h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Database connection errors</li>
<li>Application unable to read/write data</li>
<li>PostgreSQL container crash loop</li>
</ul>
<p><strong>Recovery Steps:</strong></p>
<pre><code class="language-bash"># 1. Stop application services
docker stop peppertree_backend_prod peppertree_frontend_prod

# 2. Backup current (corrupted) database
docker exec peppertree_db_prod pg_dump -U postgres peppertree &gt; /backups/corrupted_$(date +%Y%m%d).sql

# 3. Stop database
docker stop peppertree_db_prod

# 4. Remove corrupted volume (DESTRUCTIVE)
docker volume rm postgres_data_prod

# 5. Restore from latest backup
docker start peppertree_db_prod
sleep 10

# Find latest backup
LATEST_BACKUP=$(ls -t /backups/peppertree_*.sql.gz | head -1)
gunzip -c $LATEST_BACKUP | docker exec -i peppertree_db_prod psql -U postgres peppertree

# 6. Restart application
docker start peppertree_backend_prod peppertree_frontend_prod

# Recovery Time: 15-30 minutes
# Data Loss: Up to 24 hours (last backup)
</code></pre>
<h4>Scenario 3: Complete VPS Failure</h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>VPS unresponsive</li>
<li>SSH connection timeout</li>
<li>Website completely down</li>
</ul>
<p><strong>Recovery Steps:</strong></p>
<p><strong>Phase 1: Immediate Response (0-30 minutes)</strong></p>
<pre><code class="language-bash"># 1. Contact VPS provider support
# 2. Check provider status page
# 3. Notify stakeholders via communication plan
# 4. Set up temporary holding page if needed (optional)
</code></pre>
<p><strong>Phase 2: Provision New VPS (30 minutes - 2 hours)</strong></p>
<pre><code class="language-bash"># 1. Provision new VPS (same or better specs)
#    - 2 vCPU / 8 GB RAM / 80 GB SSD
#    - Ubuntu 24.04 LTS

# 2. Initial server setup
ssh root@new-vps-ip

# Update system
apt update &amp;&amp; apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# Install Docker Compose
apt install docker-compose-plugin -y

# Create user
adduser peppertree
usermod -aG docker peppertree
su - peppertree
</code></pre>
<p><strong>Phase 3: Deploy Application (2-3 hours)</strong></p>
<pre><code class="language-bash"># 1. Clone repository or copy files
git clone https://github.com/yourusername/17peppertree.git
cd 17peppertree

# 2. Restore configuration files from backup
# (Download from cloud storage)
rclone copy remote:peppertree-backups/config_latest.tar.gz .
tar -xzf config_latest.tar.gz

# 3. Set up environment
cp .env.example .env
nano .env  # Configure with backed up values

# 4. Restore SSL certificates
cp -r ssl/ /home/peppertree/17peppertree/ssl/

# 5. Deploy containers
docker compose -f docker-compose.production.yml up -d

# 6. Wait for database to initialize
sleep 30
</code></pre>
<p><strong>Phase 4: Database Restoration (3-4 hours)</strong></p>
<pre><code class="language-bash"># 1. Download latest database backup
rclone copy remote:peppertree-backups/peppertree_latest.sql.gz .
rclone copy remote:peppertree-backups/keycloak_latest.sql.gz .

# 2. Restore main database
gunzip -c peppertree_latest.sql.gz | \
  docker exec -i peppertree_db_prod psql -U postgres peppertree

# 3. Restore Keycloak database
gunzip -c keycloak_latest.sql.gz | \
  docker exec -i peppertree_keycloak_db_prod psql -U keycloak keycloak

# 4. Restart services
docker compose -f docker-compose.production.yml restart
</code></pre>
<p><strong>Phase 5: DNS and Verification (4 hours)</strong></p>
<pre><code class="language-bash"># 1. Update DNS A record to new VPS IP
#    - TTL should be 5 minutes for faster propagation
#    - DNS propagation: 5 minutes to 48 hours

# 2. Verify all services
curl -k https://new-vps-ip/api/health
docker ps -a
docker logs peppertree_backend_prod

# 3. Test booking flow
# 4. Notify stakeholders of restoration

# Total Recovery Time: 4-8 hours (depends on DNS propagation)
# Data Loss: Up to 24 hours (last backup)
</code></pre>
<h4>Scenario 4: Ransomware/Security Breach</h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Encrypted files</li>
<li>Unauthorized access detected</li>
<li>Suspicious database modifications</li>
</ul>
<p><strong>Recovery Steps:</strong></p>
<pre><code class="language-bash"># 1. IMMEDIATE: Isolate system
#    - Shut down VPS
#    - Block all incoming traffic
#    - Document evidence

# 2. Assess damage
#    - Review logs
#    - Identify breach vector
#    - Determine data exposure

# 3. Deploy to new clean VPS
#    - Follow &quot;Complete VPS Failure&quot; procedure
#    - Use backup from BEFORE breach date
#    - Change ALL credentials

# 4. Security hardening
#    - Update all software
#    - Implement firewall rules
#    - Enable fail2ban
#    - Review access logs

# 5. Notify affected parties if data exposed

# Recovery Time: 8-24 hours
# Data Loss: Variable (depends on breach timing)
</code></pre>
<h3>2.3 Recovery Testing</h3>
<h4>Quarterly DR Drill</h4>
<p><strong>Test 1: Database Restore (Every Quarter)</strong></p>
<pre><code class="language-bash"># 1. Create test VPS or local environment
# 2. Restore latest backup
# 3. Verify data integrity
# 4. Document time taken and issues
# 5. Update procedures if needed
</code></pre>
<p><strong>Test 2: Full System Restore (Annually)</strong></p>
<pre><code class="language-bash"># 1. Provision new test VPS
# 2. Execute complete DR procedure
# 3. Verify functionality end-to-end
# 4. Document RTO/RPO actual vs. target
# 5. Update DR plan with lessons learned
</code></pre>
<hr>
<h2>3. Communication Plan</h2>
<h3>3.1 Stakeholder Notification</h3>
<p><strong>During Incident:</strong></p>
<table>
<thead>
<tr>
<th>Stakeholder</th>
<th>Method</th>
<th>Timing</th>
<th>Information</th>
</tr>
</thead>
<tbody><tr>
<td>Property Owner</td>
<td>Phone + Email</td>
<td>Immediately</td>
<td>Outage notification, ETA</td>
</tr>
<tr>
<td>Technical Team</td>
<td>SMS + Slack</td>
<td>Immediately</td>
<td>Incident details, actions</td>
</tr>
<tr>
<td>Guests (if needed)</td>
<td>Email</td>
<td>Within 1 hour</td>
<td>Service interruption notice</td>
</tr>
</tbody></table>
<p><strong>Template Email:</strong></p>
<pre><code>Subject: [URGENT] 17 @ Peppertree Website Temporary Outage

Dear [Owner/Guest],

We are currently experiencing technical difficulties with the 17 @ Peppertree 
booking website. Our team is working to resolve the issue.

Status: [Brief description]
Expected Resolution: [ETA or &quot;investigating&quot;]
Alternative Booking: [Phone number or email]

We apologize for any inconvenience and will update you as soon as service is restored.

Best regards,
Technical Support Team
</code></pre>
<h3>3.2 Incident Log</h3>
<p><strong>Document for Each Incident:</strong></p>
<ul>
<li>Date and time of detection</li>
<li>Type of failure</li>
<li>Root cause analysis</li>
<li>Recovery actions taken</li>
<li>Actual RTO/RPO achieved</li>
<li>Lessons learned</li>
<li>Preventive measures implemented</li>
</ul>
<p><strong>Template:</strong> <code>/docs/incident-log-template.md</code></p>
<hr>
<h2>4. Preventive Measures</h2>
<h3>4.1 Security Hardening</h3>
<p><strong>Firewall Configuration:</strong></p>
<pre><code class="language-bash"># UFW firewall setup
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp    # SSH
ufw allow 80/tcp    # HTTP
ufw allow 443/tcp   # HTTPS
ufw enable
</code></pre>
<p><strong>SSH Security:</strong></p>
<pre><code class="language-bash"># Disable password authentication
# /etc/ssh/sshd_config
PasswordAuthentication no
PermitRootLogin no
PubkeyAuthentication yes

# Use SSH keys only
# Implement fail2ban for brute force protection
apt install fail2ban
</code></pre>
<p><strong>Docker Security:</strong></p>
<pre><code class="language-bash"># Run containers as non-root user
# Limit container resources
# Keep images updated
docker compose pull
docker compose up -d
</code></pre>
<h3>4.2 Automated Updates</h3>
<p><strong>Security Updates (Unattended Upgrades):</strong></p>
<pre><code class="language-bash">apt install unattended-upgrades
dpkg-reconfigure -plow unattended-upgrades
</code></pre>
<p><strong>Docker Image Updates (Monthly):</strong></p>
<pre><code class="language-bash">#!/bin/bash
# /scripts/update-images.sh

cd /home/peppertree/17peppertree
docker compose -f docker-compose.production.yml pull
docker compose -f docker-compose.production.yml up -d
docker image prune -f
</code></pre>
<h3>4.3 Performance Optimization</h3>
<p><strong>PostgreSQL Tuning:</strong></p>
<pre><code class="language-sql">-- Periodic vacuum and analyze
VACUUM ANALYZE booking_requests;

-- Monitor slow queries
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
</code></pre>
<p><strong>Log Rotation:</strong></p>
<pre><code class="language-bash"># /etc/logrotate.d/peppertree
/home/peppertree/17peppertree/logs/nginx/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        docker exec peppertree_nginx_prod nginx -s reopen
    endscript
}
</code></pre>
<hr>
<h2>5. Cost Analysis</h2>
<h3>5.1 Current DR Costs</h3>
<table>
<thead>
<tr>
<th>Item</th>
<th>Cost</th>
<th>Frequency</th>
</tr>
</thead>
<tbody><tr>
<td>VPS (Primary)</td>
<td>$50</td>
<td>Monthly</td>
</tr>
<tr>
<td>Cloud Backup Storage (100GB)</td>
<td>$2-5</td>
<td>Monthly</td>
</tr>
<tr>
<td>Uptime Monitoring</td>
<td>Free-$10</td>
<td>Monthly</td>
</tr>
<tr>
<td>SSL Certificate</td>
<td>Free (Let&#39;s Encrypt)</td>
<td>-</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>$52-65</strong></td>
<td><strong>Monthly</strong></td>
</tr>
</tbody></table>
<h3>5.2 Enhanced HA Options (Future)</h3>
<table>
<thead>
<tr>
<th>Enhancement</th>
<th>Cost</th>
<th>Benefit</th>
</tr>
</thead>
<tbody><tr>
<td>Managed Database</td>
<td>+$15-30/mo</td>
<td>Automated backups, failover</td>
</tr>
<tr>
<td>Load Balancer</td>
<td>+$10-20/mo</td>
<td>Better uptime, traffic distribution</td>
</tr>
<tr>
<td>Second VPS (Standby)</td>
<td>+$50/mo</td>
<td>Hot failover, &lt;5min RTO</td>
</tr>
<tr>
<td>Advanced Monitoring (DataDog, etc.)</td>
<td>+$15-50/mo</td>
<td>Better insights, alerting</td>
</tr>
<tr>
<td><strong>Full HA Setup</strong></td>
<td><strong>+$90-150/mo</strong></td>
<td><strong>99.9%+ uptime</strong></td>
</tr>
</tbody></table>
<h3>5.3 Cost-Benefit Recommendation</h3>
<p><strong>Current Plan: Acceptable for small business</strong></p>
<ul>
<li>Low cost ($52-65/mo)</li>
<li>Reasonable RTO (4 hours)</li>
<li>Manual intervention acceptable</li>
<li>Focus on robust backups</li>
</ul>
<p><strong>When to Upgrade:</strong></p>
<ul>
<li>Hosting 5+ properties (shared revenue)</li>
<li>Consistent high traffic</li>
<li>Critical booking periods (holiday seasons)</li>
<li>Revenue loss from downtime exceeds HA costs</li>
</ul>
<hr>
<h2>6. Recovery Runbooks</h2>
<h3>6.1 Quick Reference Guide</h3>
<p><strong>Emergency Contacts:</strong></p>
<pre><code>VPS Provider Support: [Phone/Ticket URL]
DNS Provider: [Login URL]
Backup Storage: [Access URL]
Technical Lead: [Name/Phone]
Property Owner: [Name/Phone]
</code></pre>
<p><strong>Critical Access Information:</strong></p>
<pre><code>VPS IP: [Document separately - secure location]
SSH Key Location: [Path]
.env Backup Location: [Encrypted storage path]
Cloud Backup: [rclone remote name]
</code></pre>
<h3>6.2 Service Restoration Checklist</h3>
<p><strong>Step-by-Step Recovery:</strong></p>
<ul>
<li><input disabled="" type="checkbox"> Assess situation and identify failure type</li>
<li><input disabled="" type="checkbox"> Notify stakeholders</li>
<li><input disabled="" type="checkbox"> Document incident start time</li>
<li><input disabled="" type="checkbox"> Execute appropriate recovery procedure</li>
<li><input disabled="" type="checkbox"> Verify all services operational</li>
<li><input disabled="" type="checkbox"> Test critical functionality (booking flow)</li>
<li><input disabled="" type="checkbox"> Monitor for 24 hours post-recovery</li>
<li><input disabled="" type="checkbox"> Complete incident report</li>
<li><input disabled="" type="checkbox"> Update DR plan if needed</li>
</ul>
<hr>
<h2>7. Compliance and Data Protection</h2>
<h3>7.1 Data Backup Compliance</h3>
<p><strong>Booking Data:</strong></p>
<ul>
<li>Contains PII (names, emails, phone numbers)</li>
<li>Backed up encrypted</li>
<li>Retained for 7 years (financial records)</li>
<li>Secure deletion after retention period</li>
</ul>
<p><strong>GDPR/POPI Considerations:</strong></p>
<ul>
<li>Right to erasure: Backup retention policy</li>
<li>Data breach notification: Within 72 hours</li>
<li>Backup encryption: AES-256</li>
</ul>
<h3>7.2 Backup Encryption</h3>
<pre><code class="language-bash"># Encrypt backups before cloud upload
gpg --symmetric --cipher-algo AES256 backup.sql.gz

# Decrypt for restore
gpg --decrypt backup.sql.gz.gpg &gt; backup.sql.gz
</code></pre>
<hr>
<h2>8. Continuous Improvement</h2>
<h3>8.1 Post-Incident Review</h3>
<p>After each incident or DR test:</p>
<ol>
<li>Conduct post-mortem meeting</li>
<li>Document what went well</li>
<li>Identify improvements</li>
<li>Update procedures</li>
<li>Implement preventive measures</li>
</ol>
<h3>8.2 Plan Maintenance</h3>
<p><strong>Review Schedule:</strong></p>
<ul>
<li><strong>Monthly:</strong> Update contact information, verify backups</li>
<li><strong>Quarterly:</strong> DR drill, procedure validation</li>
<li><strong>Annually:</strong> Full plan review and update</li>
</ul>
<p><strong>Version Control:</strong></p>
<ul>
<li>Keep DR plan in git repository</li>
<li>Document changes in commit messages</li>
<li>Maintain changelog section</li>
</ul>
<hr>
<h2>9. Conclusion</h2>
<p>This HA/DR plan provides a cost-effective disaster recovery strategy suitable for a small hospitality business running on a single VPS. The focus is on:</p>
<ol>
<li><strong>Robust daily backups</strong> with off-site storage</li>
<li><strong>Automated monitoring</strong> and alerting</li>
<li><strong>Clear recovery procedures</strong> for common scenarios</li>
<li><strong>Acceptable RTO/RPO</strong> for business continuity</li>
<li><strong>Proactive maintenance</strong> to prevent incidents</li>
</ol>
<h3>Key Success Factors</h3>
<p>‚úÖ <strong>Automated daily backups</strong> tested quarterly<br>‚úÖ <strong>Off-site backup storage</strong> (cloud)<br>‚úÖ <strong>Documented recovery procedures</strong> accessible offline<br>‚úÖ <strong>Regular DR testing</strong> with timing documentation<br>‚úÖ <strong>Clear communication plan</strong> for stakeholders<br>‚úÖ <strong>Cost-effective</strong> solution matching business size  </p>
<p><strong>Next Steps:</strong></p>
<ol>
<li>Implement automated backup script with cron</li>
<li>Configure off-site backup sync (rclone)</li>
<li>Set up uptime monitoring (UptimeRobot)</li>
<li>Schedule first DR test</li>
<li>Print critical procedures for offline access</li>
</ol>
<hr>
<h2>Related Documentation</h2>
<ul>
<li><a href="./VPS_SETUP_GUIDE.html">VPS_SETUP_GUIDE.md</a> - Infrastructure requirements and VPS setup</li>
<li><a href="./DEPLOYMENT_GUIDE.html">DEPLOYMENT_GUIDE.md</a> - Deployment procedures</li>
<li><a href="./DOCKER_SETUP.html">DOCKER_SETUP.md</a> - Container configuration</li>
</ul>
<hr>
<p><strong>Document Owner:</strong> Technical Team<br><strong>Review Date:</strong> 2026-02-21 (Quarterly)<br><strong>Approval:</strong> [Property Owner Name]</p>

  </main>
  
  <button id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë Top</button>
  
  <script>
    // Show/hide back to top button
    window.addEventListener('scroll', () => {
      const btn = document.getElementById('back-to-top');
      if (window.scrollY > 300) {
        btn.style.display = 'block';
      } else {
        btn.style.display = 'none';
      }
    });
    
    // Fix relative links to work with .html extension
    document.querySelectorAll('a[href$=".md"]').forEach(link => {
      const href = link.getAttribute('href');
      link.setAttribute('href', href.replace(/.md$/, '.html'));
    });
    
    // Convert relative links
    document.querySelectorAll('a[href^="../"]').forEach(link => {
      const href = link.getAttribute('href');
      if (href.includes('README.md')) {
        link.setAttribute('href', 'README.html');
      }
    });
  </script>
</body>
</html>